# Управление учетными записями пользователей Linux\Unix
##  Overview
В целом, пользователь в \*nix системах - это всего лишь 4 байтовое число, которое играет роль в идентификации процессов и файлов ([[processes]] ,[[filesystem]]) , и в разраграничении доступа ([[access_mng]]). Почти вся работа c учетными записями пользователей крутится вокруг файлов **/etc/passwd, /etc/shadow** и **/etc/group**. Учетная запись может быть как у реального человека, так и службы, что позволяет лучше разбираться, какая служба использует данный ресурс.
****
## Хранение информации о пользователях
Для хранения информация о пользователях используется файл **/etc/passwd**, который состоит из записей о пользователях. Каждая такая запись состоит из регистрационного имени, хэшированного пароля(если таковой не вынесен в **/etc/shadow**), UID, GID, GECOS(поле, которое редко заполняется и содержит различную дополнительную информацию, по типу номера телефона, номера кабинета, города и пр.), пути домашнего каталога и регистрационной оболочки.
#### Регистрационное имя
Регистрационное имя - это username, не превышающий длины в 32 символа и по большинству стандартов должет позволять легко идентифицировать человека или службу, которые закреплены за этим username.
Если пользователем является человек, то принято использовать в качестве username имя и фамилию, написанные в нижнем регистре(хоть и система нерегистрочувствительна к имена пользователей, может возникнуть казус, если регистрационное имя у пользователей будет различаться лишь регистром).
#### Пароль и /etc/shadow
Изначально, пароль шифровался(алгоритмом DES) и распологался прямо внутри файла **/etc/passwd**. Но с уменьшением техпроцесса и появлением параллельных вычислений стало несложно перебрать все самые распространенные пароли грубым способом. Поэтому, было принято решение переместить хэшированный пароль в защищенный о чтения файл **/etc/shadow**, который состоит из регистрационного имени, непостредственно пароли и различных временых меток и дат истечения старого пароля.
#### UID и GID
Как и говорилось ране, пользователь - просто число, которое помогает в идентификации принадлежности ресурсов. Это число называется User ID. Для каждого пользователя его UID уникален. Системные(root, system, admin) пользователи и службы используют UID в диапазоне от 0 до 1000. GID - тоже самое, что и UID, но только для групп.
#### Домашний каталог и регистрационная оболочка
У каждого пользователя, будь то служба, обычный или системный пользователь, существует каталог, который является для него основным и в котором содержаться конфигурационные файлы, ключи ssh, файлы **history** и пр. Такой каталог называется домашним и пользователя целиком и полностью имеет право *rwx* на всё его содержимое. Домашний каталог текущего пользователя обозначается **~**. Также, можно получить имена домашних каталогов других пользователей, набрав **~username**. Регистрационная оболочка - оболочка, которая ставится по умолчанию для пользователя, в которую он попадает после логина\регистрации (например **/bin/bash**, **/usr/bin/zsh**).
****
## Создание, удаление и блокирование пользователей
Администратор, в силу своих полномочий, обязан управлять учетными записями пользователями. Под "управлением" понимается любое действие, связанное с изменением статуса и любой информациий о пользователе: пароля, прав доступа, описания и пр.
#### Создание 
Как было сказано выше, вся работа с пользователями зиждится на трех-двух файлах. Чтобы создать учетную запись достаточно внести новую запись в файл **/etc/passwd**. К сожаление, одной записью дело не ограничится: необходимо, чтобы был создан каталог и рекурсивно переназначены права доступа на создаваемого пользователя. Для автоматизации рутинных задач существует множество более высоуровневых утилит: **useradd, adduser, newusers**. Например, **useradd** автоматически создает каталог и переназначает права, хэширует пароль, назначает UID и многое другое. Все такие тонкости как алгоритм хэширования, каталог, в котором создается домашний каталог, регистрационная оболочка, настраиваются в отдельных файлах (в каждой системе разные имена: **/etc/login.defs, /etc/login.conf**).
#### Удаление
Удаление происходит обратно созданию: удаляются домашний каталог, различные временные файлы, убиваются все принадлежащие пользователю процессы, файлы почты(если пользователем является человек(или нет)). Само собой, ликвидируется соответсвующая запись в **/etc/passwd**.
#### Блокирование
В данном случае, блокирование - это создание невозможности логина в данного пользователя. То есть, все пользователи служб заблокированы, ибо залогиниться в них невозможно. Чтобы заблокировать пользователя достаточно поставить **\*** в поле пароля в файле **/etc/shadow**. В системах Linux заблокировать пароль можно командой **sudo usermod -L *username***, разблокировать - поменяв флаг **-L** на **-U**.
****
	